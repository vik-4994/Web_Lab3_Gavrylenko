<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>–ì–æ–ª–æ–≤–Ω–∞</title>
</head>
<body>
<h1 id="status">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</h1>

<div id="userInfo" style="display: none;">
    <p><strong>User ID:</strong> <span id="userId"></span></p>
    <button id="wsBtn">–û—Ç—Ä–∏–º–∞—Ç–∏ –∫—É—Ä—Å BTC/USDT</button>
    <p><strong>–ö—É—Ä—Å:</strong> <span id="btcPrice">‚Äî</span></p>
</div>

<button id="loginBtn" onclick="window.location.href='/login'" style="display: none;">
    üîê –£–≤—ñ–π—Ç–∏
</button>

<script>
    fetch('/status')
        .then(res => res.json())
        .then(data => {
            if (data.loggedIn) {
                document.getElementById('status').innerText = "‚úÖ –í–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ!";
                fetch('/me')
                    .then(res => res.json())
                    .then(info => {
                        document.getElementById('userId').innerText = info.sub || '–Ω–µ–≤—ñ–¥–æ–º–æ';
                        document.getElementById('userInfo').style.display = 'block';
                    });
            } else {
                document.getElementById('status').innerText = "‚ùå –í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ.";
                document.getElementById('loginBtn').style.display = 'inline-block';
            }
        })
        .catch(() => {
            document.getElementById('status').innerText = "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å—É.";
        });

    // WebSocket logic
    document.getElementById("wsBtn").addEventListener("click", () => {
        const socket = new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@trade");

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            const price = parseFloat(data.p).toFixed(2);
            document.getElementById("btcPrice").innerText = price + " USDT";
        };

        socket.onerror = function(error) {
            document.getElementById("btcPrice").innerText = "–ü–æ–º–∏–ª–∫–∞ WebSocket";
        };

        socket.onclose = function() {
            document.getElementById("btcPrice").innerText += "(–∑'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ)";
        };
    });
</script>
</body>
</html>
